{% extends "base.html" %}
{% block content %}
<h2>库存管理</h2>
<!-- 库存调整表单（弹出模态框） -->
<table class="table table-striped">
    <thead>
        <tr><th>ID</th><th>商品名称</th><th>当前库存</th><th>预警下限</th><th>状态</th><th>操作</th></tr>
    </thead>
    <tbody>
        {% for item in inventory %}
        <tr class="{% if item[2] < item[3] %}table-danger{% endif %}">
            <td>{{ item[0] }}</td>
            <td>{{ item[1] }}</td>
            <td>{{ item[2] }}</td>
            <td>{{ item[3] }}</td>
            <td>{% if item[2] < item[3] %}库存不足{% else %}正常{% endif %}</td>
            <td>
                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#adjustModal{{ item[0] }}">调整</button>
            </td>
        </tr>
        <!-- 调整模态框 -->
        <div class="modal fade" id="adjustModal{{ item[0] }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" action="{{ url_for('adjust_inventory') }}">
                        <div class="modal-header">
                            <h5 class="modal-title">调整库存 - {{ item[1] }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="product_id" value="{{ item[0] }}">
                            <div class="mb-3">
                                <label>当前库存</label>
                                <input type="text" class="form-control" value="{{ item[2] }}" disabled>
                            </div>
                            <div class="mb-3">
                                <label>变动数量（正数增加，负数减少）</label>
                                <input type="number" name="delta" class="form-control" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-primary">确认调整</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </tbody>
</table>
{% endblock %}