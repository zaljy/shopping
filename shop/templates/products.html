{% extends "base.html" %}
{% block content %}
<h2>商品管理</h2>
<!-- 添加商品表单 -->
<div class="card mb-4">
    <div class="card-header">添加新商品</div>
    <div class="card-body">
        <form method="post" action="{{ url_for('add_product') }}">
            <div class="row">
                <div class="col-md-2"><input type="text" name="barcode" class="form-control" placeholder="条码(可选)"></div>
                <div class="col-md-2"><input type="text" name="name" class="form-control" placeholder="名称*" required></div>
                <div class="col-md-2"><input type="text" name="category" class="form-control" placeholder="类别"></div>
                <div class="col-md-1"><input type="number" step="0.01" name="price" class="form-control" placeholder="售价*" required></div>
                <div class="col-md-1"><input type="number" step="0.01" name="cost" class="form-control" placeholder="成本*" required></div>
                <div class="col-md-2"><input type="text" name="supplier" class="form-control" placeholder="供应商"></div>
                <div class="col-md-2"><button type="submit" class="btn btn-primary">添加</button></div>
            </div>
        </form>
    </div>
</div>

<!-- 商品列表 -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th><th>条码</th><th>名称</th><th>类别</th><th>售价</th><th>成本</th><th>供应商</th><th>库存</th><th>预警</th><th>操作</th>
        </tr>
    </thead>
    <tbody>
        {% for p in products %}
        <tr>
            <td>{{ p[0] }}</td>
            <td>{{ p[1] or '' }}</td>
            <td>{{ p[2] }}</td>
            <td>{{ p[3] }}</td>
            <td>{{ p[4] }}</td>
            <td>{{ p[5] }}</td>
            <td>{{ p[6] }}</td>
            <td>{{ p[7] }}</td>
            <td>{{ p[8] }}</td>
            <td>
                <a href="#" class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ p[0] }}">编辑</a>
                <a href="{{ url_for('delete_product', product_id=p[0]) }}" class="btn btn-sm btn-danger" onclick="return confirm('确定删除？')">删除</a>
            </td>
        </tr>
        <!-- 编辑模态框 -->
        <div class="modal fade" id="editModal{{ p[0] }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" action="{{ url_for('update_product', product_id=p[0]) }}">
                        <div class="modal-header">
                            <h5 class="modal-title">编辑商品 #{{ p[0] }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label>条码</label>
                                <input type="text" name="barcode" class="form-control" value="{{ p[1] or '' }}">
                            </div>
                            <div class="mb-3">
                                <label>名称</label>
                                <input type="text" name="name" class="form-control" value="{{ p[2] }}" required>
                            </div>
                            <div class="mb-3">
                                <label>类别</label>
                                <input type="text" name="category" class="form-control" value="{{ p[3] }}">
                            </div>
                            <div class="mb-3">
                                <label>售价</label>
                                <input type="number" step="0.01" name="price" class="form-control" value="{{ p[4] }}" required>
                            </div>
                            <div class="mb-3">
                                <label>成本</label>
                                <input type="number" step="0.01" name="cost" class="form-control" value="{{ p[5] }}" required>
                            </div>
                            <div class="mb-3">
                                <label>供应商</label>
                                <input type="text" name="supplier" class="form-control" value="{{ p[6] }}">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-primary">保存</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </tbody>
</table>
{% endblock %}